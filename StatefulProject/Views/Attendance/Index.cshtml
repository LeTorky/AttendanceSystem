@model attendanceViewModel

@{
    //Stack<Student> stack = new Stack<Student>();
    //void addStudent(Student std)
    //{
    //    stack.Push(std);
    //}

}
    <script>
        let attended = [];
        let absent = [];
        let elementsRef = [];
        let absentElementsRef = [];
        //adding element temporary
        function addStudent(element, id){
            console.log(id);
            //console.log(element);
            element.classList.add("d-none");
            attended.push(id);
            elementsRef.push(element);
        }
        function removeStudent(element, id){
            element.classList.add("d-none");
            absent.push(id);
            absentElementsRef.push(element);
        }
        //roll back the last added students
        function back(){
            if(elementsRef.length <1){
                alert("no students to roll back");
            }else{
                let element =elementsRef.pop();
                element.classList.remove("d-none");
                attended.pop();
            }
        }
        //request the server to save attendance
        function save(){
            console.log(attended)
            //console.log(elementsRef)
            //ajax call to send the array to an action save in .net and bind with studentsIDs parameter
            $(document).ready(function () {
                students = attended;

                $.ajax({
                    type: "POST",
                    url: "attendance/Save",
                    data: {studentsIDs: students},
                    dataType: "text",
                    success: function (msg) {
                        //empty the arrays to start again 
                        elementsRef = [];
                        attended =[];
                        console.log("saved and sent to server");
                        location.reload();
                    },
                    error: function (req, status, error) {
                        console.log(error);
                    }
                });	
            });
            
        }
    </script>
    
    
    <div class="alert-success" style="width: 80%; margin: auto; padding: 1em">
        <h2>assign students attendance:</h2>
        <form  class="form-inline">
            <div class="row">
                <input asp-for="date" class="form-control w-25">
                <select asp-items="Model.tracks" asp-for="selectedDeptID" class="form-control w-25">
                    <option hidden > select a department </option>
                </select>
             <input type="submit" value="Show students" class="btn btn-warning  w-25"/>
             </div>
        </form>
        <div class="my-3 d-flex flex-row-reverse">
            <button class="btn btn-danger mx-2" onclick="back()">back</button>
            <button class="btn btn-success mx-2" onclick="save()">save</button>
        </div>
            
    </div>

    <div class="row d-flex justify-content-center my-3">
        <div class="col-xl-10">
            <!-- code for the card list -->
            @if (Model.Absentstudents != null)
            {
                <div class="d-flex justify-content-center">
                    <div class="card mx-4">
                        <div class="card-header">Absent Students</div>
                        <div class="card-body d-flex flex-column flex-wrap">
                            @foreach (Student std in Model.Absentstudents)
                            {
                                <button class="btn btn-lg btn-light mb-1" onclick="addStudent(this,@std.Id)"> @std.StudentId </button>
                            }
                        </div>
                    </div>
                    @if (Model.Attendedstudents!= null && Model.Attendedstudents.Count()!= 0)
                {
                    <div class="card">
                        <div class="card-header">Attended Students</div>
                        <div class="card-body d-flex flex-column flex-wrap" id="attendedStds">
                            @foreach (Student std in Model.Attendedstudents)
                            {
                                <button class="btn btn-lg btn-light mb-1" onclick="removeStudent(this,@std.Id)"> @std.StudentId </button>
                            }
                        </div>
                    </div>
                }
            </div>

            }
        </div>
    </div>

    